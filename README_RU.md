
  
# [BETA] Custom-Regions

## Позволяет устанавливать новые регионы, не изменяя файлов игры напрямую, и делать некоторые другие интересные вещи. Имитирует совмещение папок модов и игры во время запуска и перенаправляет соединения между комнатами.

![Custom Regions!](https://cdn.discordapp.com/attachments/305139167300550666/777644000529088532/unknown.png)


## Содержание
* [Установка Custom Regions](#index1)
* [Установка регионов](#index2)
* [Удаление](#index3)
* [Как это работает?](#index4)
* [Обработка конфликтов - совмещение регионов](#index5)
* [Информация для моддеров](#index6)
	* [СТРУКТУРА ДИРЕКТОРИЙ](#index6.1)
	* [ОБЕСПЕЧЕНИЕ СОВМЕСТИМОСТИ](#index6.2)
	* [ИЛЛЮСТРАЦИИ](#index6.3)
	* [ЭЛЕКТРО-ВРАТА](#index6.4)
	* [ДОБАВЛЕНИЕ ЖЕМЧУЖИН С ТЕКСТОМ (без использования кода)](#index6.5)
	* [ИКОНКИ РЕГИОНОВ](#index6.6)
* [Известные проблемы](#index7)
* [Credits](#index8)

### <a name="index1"></a>Установка Custom Regions
1) Загрузите и установите последнюю версию Partiality Launcher из [категории "Инструменты" на RainDB](http://www.raindb.net/)
2) Скачайте последнюю релизную версию CR [отсюда](https://github.com/Garrakx/Custom-Regions/releases/)
3) Примените **все** (`EnumExtender.dll, ConfigMachine.dll, CustomAssets.dll `(если необходима кастомная музыка)`, CustomRegions.dll` и `AutoUpdate.dll`) моды из архива `[DOWNLOAD_THIS_Custom-Regions-vX.X.zip]`. Обновления будут производиться автоматически.

### <a name="index2"></a>Установка регионов
* ***Внимание:** собственные инструкции большинства модов устарели. Если вы планируете использовать CR, следуйте указаниям, приведённым ниже.*
1) Внутри Rain World\Mods создайте папку "`CustomResources`" (*После первого запуска игры с данным модом она будет создана автоматически*).
2) Внутри Rain World\Mods\CustomResources создайте папку с именем нужного вам мода (`например: Rain World\Mods\CustomResources\The Root`). Её имя определяет название региона, которое будет отображаться в игре.
3) Поместите в неё директории "`World`", "`Assets`" и / или "`Levels`" из архива необходимого вам региона.
4) При следующем запуске CR создаст в папке региона фаёл "regionInfo.json". Он может быть открыт и изменён любым текстовым редактором (к примеру, Notepad). Убедитесь, что вся находящаяся в нём информация соответствует описаниям региона. К каждому региону можно добавить описание. Параметр Region Order определяет порядок загрузки. Если предыдущая версия, которая была у вас установлена, использовала regionID.txt, CR автоматически попытается произвести апгрейд. Чтобы применить изменения, перезапустите игру или нажмите кнопку "Reload" в меню настроек. **ПОСЛЕ ПРИМЕНЕНИЯ КАКИХ-ЛИБО ИЗМЕНЕНИЙ НЕОБХОДИМО НАЧИНАТЬ ИГРУ НА СВЕЖЕМ СЛОТЕ СОХРАНЕНИЯ**.
5) CR будет загружать декали, палитры, уровни арены, иллюстрации и прочее из этой папки.
6) В меню настроек мода можно посмотреть, какие регионы активированы (подсвечены зелёным) и в каком порядке всё загружается.

### <a name="index3"></a>Деинсталляция регионов (два варианта)
Вариант 1). Откройте `Rain World\Mods\CustomResources\Your Region\regionInfo.json` и установите флаг `activated` на `false`.
Вариант 2). Удалите папку, созданную на шаге 2 (`i.e. Rain World\Mods\CustomResources\The Root`)



### <a name="index4"></a>Как это работает?
Вместо того, чтобы распаковывать архивы регионов в папку игры, вы помещаете все необходимые файлы в отдельную папку. Это поддерживает ваашу установку Rain World в чистоте и позволяет подключать несколько регионов одновременно. Вы также можете изменять распределение существ в ванильных регионах (в файлах world_XX.txt достаточно включить только интересующие вас изменения).


### <a name="index5"></a> Конфликты между регионами
CR попытается совместить все изменения, добавляемые в регион, и достичь совместимости:
![Совмещение в действии](https://cdn.discordapp.com/attachments/473881110695378964/670463211060985866/unknown.png)
Если world_XX.txt мода 1 выглядит так:
```
A: C, B, DISCONNECTED
B: A, DISCONNECTED
C: A
```
а world_XX.txt мода 2 так:
```
A: DISCONNECTED, B, C
B: A, DISCONNECTED
D: A
```
Custom Regions совместит их, и результат будет эквивалентен следующему:
```
A: C, B, D
B: A, DISCONNECTED
C: A
D: A
```

### <a name="index6"></a>Информация для моддеров
* CR сравнивает все переходы между комнатами. Если ваше соединение накладывается на ванильное, (в случае, если ваш мод загружается первым либо является единственным подключенным), вашему соединению присваивается абсолютный приоритет и оно всегда заменяет ванильное.
```
Analyzed room [SB_J01 : DISCONNECTED, SB_E02, SB_G03, SB_C07 : SWARMROOM]. Vanilla [True]. NewRoomConnections [SB_ROOTACCESS, SB_E02, SB_G03, SB_C07]. IsBeingReplaced [True]. No Empty Pipes [True]
```
* Если ваш мод изменяет комнату, которая добавлена либо уже изменена другим модом, CR попытается совместить правки
```
Replaced [SB_J03 : DISCONNECT, SB_J02, SB_F01, SB_S02] with [SB_J03 : SB_ROOTACCESS, SB_J02, SB_F01, SB_S02]
```
* Если комната, для которой CR пытается осуществить совмещение, не имеет отключенных выходов (DISCONNECTED), регионы несовместимы.
```
ERROR! #Found incompatible room [SB_J01 : SB_Q01, SB_E02, SB_G03, SB_C07] from [AR] and [SB_J01 : SB_ROOTACCESS, SB_E02, SB_G03, SB_C07 : SWARMROOM] from [TR]. Missing compatibility patch?
```
### <a name="index6.1"></a>СТРУКТУРА ДИРЕКТОРИЙ
* Чтобы создать структуру директорий вашего мода, просто имитируйте структуру директорий игры, как если бы вы собирались создавать мод, устанавливающийся прямым совмещением. **ВАЖНО:** Если вы хотите отключить соединение, активное в ванили, вам необхожимо обозначить выход как "DISCONNECTED". 
<details>
  <summary> How to delete a vanilla connection</summary>

Допустим, фрагмент world_XX.txt некоторого региона в ванили выглядит так:
```
	A: C, B, D
```
Если вам необходимо отключить соединение A с C, соответствующая строка в вашем world_XX.txt должна выглядеть так:
```
	A: DISCONNECTED, B, D
```
</details>

### <a name="index6.2"></a>ОБЕСПЕЧЕНИЕ СОВМЕСТИМОСТИ
* Наглядный пример, иллюстрирующий добавление одной комнаты в HI (Промкомплекс) (создано LeeMoriya). [Нажмите сюда](https://discordapp.com/channels/291184728944410624/431534164932689921/759459475328860160)
1) Создайте мод, загружающийся первым и изменяющий ванильную комнату, добавляя новые точки соединения в HI_A07:

Так должен выглядеть *весь* файл world_HI.txt мода NewPipes (необходимы только эти строки)
```
ROOMS
HI_A07 : HI_A14, DISCONNECTED, DISCONNECTED, HI_B04, HI_C02
END ROOMS
```
*примечание* Вам может понадобиться подвигать DISCONNECTED туда-сюда, чтобы найти раскладку, при которой ванильные соединения остаются на своих местах.

2) Создайте ещё один регион-мод, присоединяющий дополнительную комнату к HI_A07, но загружающийся после NewPipes

так должен выглядеть *весь* файл world_HI.txt регион-мода ModA
```
ROOMS
HI_A07 : HI_A14, HI_B04, HI_C02, HI_MODA, DISCONNECTED
HI_MODA : HI_A07
END ROOMS
```
3) Создайте третий мод, который также соединяется с HI_A07, и также загружается после NewPipes
Так должен выглядеть *весь* world_HI.txt мода ModB
```
ROOMS
HI_A07 : HI_A14, HI_B04, HI_C02, DISCONNECTED, HI_MODB
HI_MODB : HI_A07
END ROOMS
```
![Патч совместимости](https://cdn.discordapp.com/attachments/481900360324218880/758592126786863154/ezgif.com-optimize_1.gif)

### <a name="index6.3"></a>Иллюстрации
* Для использования иллюстраций, помимо "`positions.txt`" вам понадобится файл "`depths.txt`", где необходимо будет обозначить глубину слоёв. Порядок слоёв тот же, что и в "`positions.txt`".
* Вы можете добавить произвольное количество слоёв.
* После обновления 0.6 может понадобиться повторная настройка расположения.

### <a name="index6.4"></a>ЭЛЕКТРО-ВРАТА
* Чтобы сделать любое количество добавляемых вами ворот электрическими, в папке `Gates` директории вашего мода (рядом с `locks.txt`) создайте файл `electricGates.txt`. Используя формат, сходный с таковым в `locks.txt`, укажите названия всех ворот, которые должны стать электрическими, и высоты батарей:
```
GATE_SB_AR : 558
```
(`Rain World\Mods\CustomResources\"Your Region"\World\Gates\electricGates.txt`)
### <a name="index6.5"></a>ЖЕМЧУЖИНЫ С ТЕКСТОМ
CR добавляет возможность вводить в игру новые жемчужины с текстом без использования кода, и даже добавлять новые диалоги. Делается это следующим образом:
1. Перейдите в папку `Rain World\Mods\CustomResources\"your region name"\Assets\`. Создайте текстовый файл под названием `pearlData.txt`. Этот файл определяет данные для создания новых жемчужин и делает последние доступными в меню установки объектов.
2. Внутри `Rain World\Mods\CustomResources\"your region name"\Assets\pearlData.txt`, обозначьте данные жемчужин в следующем формате (тщательно проверяйте соответствие, все пробелы должны быть на месте):
```
1 : first_pearl_name : mainColorInHex : highlightColorInHex(optional)
2 : another_pearl_name : mainColorHex2
3 ...
```
- Первое число определяет numberID жемчужины (позже вы используете его для добавления файла диалога). 
- Второе поле - имя, которое будет отображаться для жемчужины в меню установки объектов, может быть любым (например: `root_pearl_CC`) 
- Третье поле - цвет жемчужины в шестнадцатеричном формате (например, `00FF00` для ярко-зелёного, используйте любой инструмент выбора цветов). 
- Четвёртое поле опциональное, используйте его, если хотите добавить жемчужине вторичный цвет, которым она будет периодически подсвечиваться.

*Если вы хотите добавить жемчужины без текста, можете остановиться здесь. Если вам необходимо добавить к жемчужинам реплики Луны, продолжайте следовать инструкциям*.
3. Перейдите в `Rain World\Mods\CustomResources\"your region name"\Assets\Text\Text_Eng\`. Для каждой жемчужины, которой вы хотите добавить уникальные диалоги, создайте свой текстовый файл. Используя приведённый выше пример, если вы хотите добавить диалог для жемчужины *first_pearl_name*, вам необходимо создать текстовый файл `1.txt` (номер, соответствующий идентификатору жемчужины из первого поля). Откройте файл и поместите туда необходимый текст. ***НЕ ИСПОЛЬЗУЙТЕ ЗДЕСЬ ИСХОДНЫЕ ФАЙЛЫ; СДЕЛАЙТЕ РЕЗЕРВНУЮ КОПИЮ***
Пример:
```
0-46
Первая строка в первом окне диалога.<LINE>Вторая строка в первом окне диалога.

Это первая строка второго окна диалога!
```
Из моддинг-вики:
`Первая строка файла должна иметь вид **0-##**, где **##**  - номер файла.`
Поддерживается локализация кастомных жемчужин. Чтобы добавить переводы, поместите текст в сходном формате в соответствующую языковую папку (Text_Fre, Text_Ger, Text_Rus и т.д.). Если вы не планируете добавлять локализацию, просто скопируйте туда текст на английском, чтобы избежать вылетов.

4. Запустите игру (естественно, CR должен быть подключен). Игра зашифрует файлы диалогов, чтобы затруднить дата-майнинг. Поставляйте эти зашифрованные файлы в комплекте с вашим модом.

### <a name="index6.6"></a>ИКОНКИ МЕНЮ
- Игра проверяет, существует ли файл `thumb.png` рядом с `regionInfo.json` (разрешение должно быть равно 360x250 px).
- Если иконки нет, игра попытается загрузить её с raindb.net (то же самое происходит с описаниями).
- Если автозагрузка по какой-то причине не работает, свяжитесь с авторами.

### <a name="index7"></a>Известные проблемы
* Из-за особенностей работы системы сохранений подключение / отключение регион-модов требует от пользователя использования свежей ячейки сохранения.

### <a name="index8"></a>Благодарности
Отдалённо вдохновлено EasyModPack, созданного @topicular. Цели за время разработки сильно изменились. Пожалуйста, будьте терпеливы с возможными багами. Спасибо LeeMoriya за помощь и предложения.
